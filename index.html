<!DOCTYPE html>
<html lang="ko" data-theme="system">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asphalt Legends ê³„ì‚°ê¸° Â· Preset Â· History Â· Theme Â· Share</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #0f172a; /* slate-900 */
      --muted: #6b7280; /* gray-500 */
      --card: #f8fafc; /* slate-50 */
      --border: #e5e7eb; /* gray-200 */
      --accent: #3b82f6; /* blue-500 */
      --accent-fg: #ffffff;
      --danger: #ef4444; /* red-500 */
      --success: #10b981; /* emerald-500 */
    }
    [data-theme="dark"] {
      --bg: #0b1020;
      --fg: #e5e7eb;
      --muted: #9aa1ad;
      --card: #0f172a;
      --border: #1f2937;
      --accent: #60a5fa;
      --accent-fg: #0b1020;
      --danger: #f87171;
      --success: #34d399;
    }
    /* === Extra Themes === */
    [data-theme="onyx"]{
      --bg: linear-gradient(135deg, #0b0b0b, #1a1a1a);
      --fg:#e0e0e0; --muted:#8a8a8a; --card:#121212; --border:#1f1f1f;
      --accent:#3a8ef6; --accent-fg:#000;
    }
    [data-theme="chroma-glow"]{
      --bg: linear-gradient(120deg, #000000, #1b0034 40%, #002f4b 80%);
      --fg:#f4f4f4; --muted:#9d9d9d; --card:#090909; --border:#1a1a1a;
      --accent: linear-gradient(90deg, #ff00cc, #3333ff); --accent-fg:#ffffff;
    }
    [data-theme="sunset"]{
      --bg: linear-gradient(160deg, #ff9966, #ff5e62);
      --fg:#fff8f0; --muted:#ffe0c7; --card: rgba(255,255,255,0.08); --border:#ffffff22;
      --accent:#ffd700; --accent-fg:#703300;
    }
    [data-theme="forest"]{
      --bg: linear-gradient(180deg, #0a3d2e, #062a1f);
      --fg:#d8f3dc; --muted:#a9d6c6; --card:#0d2f22; --border:#1a3a2c;
      --accent:#52b788; --accent-fg:#0a3d2e;
    }
    [data-theme="crimson-moon"]{
      --bg: linear-gradient(145deg, #1b0a0f, #3a0b14);
      --fg:#f8d7da; --muted:#b89a9c; --card:#2b1018; --border:#4a1a24;
      --accent:#ff4d6d; --accent-fg:#220006;
    }
    [data-theme="midnight-blueviolet"]{
      --bg: linear-gradient(135deg, #0f172a, #1e1b4b, #312e81);
      --fg:#e0e7ff; --muted:#a5b4fc; --card:#1e1b4b; --border:#2a2c5a;
      --accent:#818cf8; --accent-fg:#0f172a;
    }
    [data-theme="neon-night"]{
      --bg:#05010f;
      --fg:#e6e6fa; --muted:#9a9abd; --card: linear-gradient(135deg, #0b0019, #12002b); --border:#2a1149;
      --accent: linear-gradient(90deg, #00ffff, #ff00ff); --accent-fg:#000;
    }
    [data-theme="aurora"]{
      --bg: linear-gradient(160deg, #0b0033, #004f4f 40%, #001a33 90%);
      --fg:#e0f7fa; --muted:#a7cbd1; --card: rgba(255,255,255,0.05); --border:#58a6aa44;
      --accent: linear-gradient(90deg, #00ffff, #00ff87, #00ffa2); --accent-fg:#001818;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--fg);
    }
    .container { max-width: 980px; margin: 24px auto; padding: 0 16px; }
    .row { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; }
    .title { font-weight: 800; font-size: 22px; margin: 0 0 8px; }
    .subtitle { color: var(--muted); font-size: 14px; margin-bottom: 12px; }
    label { font-size: 13px; color: var(--muted); display: block; margin-bottom: 6px; }
    input[type="number"], input[type="text"], select { width: 100%; padding: 10px 12px; background: var(--bg); color: var(--fg); border: 1px solid var(--border); border-radius: 12px; outline: none; }
    input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .inline { display: flex; gap: 8px; align-items: center; }
    .btn { cursor: pointer; border: 1px solid var(--border); background: var(--bg); color: var(--fg); border-radius: 12px; padding: 10px 14px; font-weight: 700; }
    .btn:hover { border-color: var(--accent); }
    .btn.primary { background: var(--accent); color: var(--accent-fg); border-color: var(--accent); }
    .btn.ghost { background: transparent; }
    .btn.small { padding: 6px 10px; font-weight: 600; }
    .chip { display:inline-flex; align-items:center; gap:6px; background: var(--bg); border:1px solid var(--border); padding:6px 10px; border-radius:999px; color:var(--muted); font-size:12px; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .grid-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    .pack { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
    .pack input { text-align: right; font-variant-numeric: tabular-nums; }
    .stat { display:flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed var(--border); font-variant-numeric: tabular-nums; }
    .stat:last-child { border-bottom: 0; }
    .muted { color: var(--muted); }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace; font-size: 12px; background: var(--bg); border:1px solid var(--border); border-radius:6px; padding:2px 6px; }
    .section-title { font-weight: 800; margin: 8px 0 6px; font-size: 16px; }
    hr { border: 0; height: 1px; background: var(--border); margin: 12px 0; }
    .list { display:flex; flex-direction: column; gap:8px; }
    .history-item { display:flex; justify-content: space-between; gap:12px; align-items:center; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:var(--bg); }
    .tag { background: var(--card); border:1px solid var(--border); color: var(--muted); font-size:12px; padding:2px 8px; border-radius:999px; }
    .danger { color: var(--danger); }
    .success { color: var(--success); }
    .spacer { height: 4px; }
    .dev { font-size:12px; color:var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <!-- Header Card -->
      <div class="card" style="grid-column: span 12; display:flex; justify-content: space-between; align-items: center; gap:12px; flex-wrap: wrap;">
        <div>
          <div class="title">Asphalt Legends ê²°ì œ ê³„ì‚°ê¸° â€” Preset Â· History Â· Share</div>
          <div class="subtitle">í”„ë¦¬ì…‹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°, ìµœê·¼ 5íšŒ íˆìŠ¤í† ë¦¬, ìš”ì•½ ë³µì‚¬(í…ìŠ¤íŠ¸/Markdown/Discord), í…Œë§ˆ(ë¼ì´íŠ¸/ë‹¤í¬/ì‹œìŠ¤í…œ) ì§€ì›</div>
        </div>
        <div class="inline" role="group" aria-label="Theme">
          <label for="themeSelect" class="muted" style="font-size:13px;">í…Œë§ˆ</label>
          <select id="themeSelect">
            <option value="system">ì‹œìŠ¤í…œ</option>
            <option value="light">ë¼ì´íŠ¸</option>
            <option value="dark">ì–´ë‘ìš´ í…Œë§ˆ</option>
            <option value="onyx">ì˜¤ë‹‰ìŠ¤</option>
            <option value="chroma-glow">í¬ë¡œë§ˆ ê·¸ë¡œìš°</option>
            <option value="sunset">ì¼ëª°</option>
            <option value="forest">ìˆ²</option>
            <option value="crimson-moon">ì§„í™ë¹› ë‹¬</option>
            <option value="midnight-blueviolet">í•œë°¤ì¤‘ íŒŒë‘ë³´ë¼</option>
            <option value="neon-night">ë„¤ì˜¨ ë‚˜ì´íŠ¸</option>
            <option value="aurora">ì˜¤ë¡œë¼</option>
          </select>
        </div>
      </div>

      <!-- Input Card -->
      <div class="card" style="grid-column: span 8;">
        <div class="section-title">ì…ë ¥</div>
        <div class="grid-3" id="packs"><!-- Packs will be injected --></div>
        <div class="spacer"></div>
        <div class="grid-3">
          <div>
            <label for="extraARS">ì¶”ê°€ ê¸ˆì•¡(ARS)</label>
            <input id="extraARS" type="number" min="0" value="0" />
          </div>
          <div>
            <label for="rate">í™˜ìœ¨ (1 ARS â†’ KRW)</label>
            <input id="rate" type="number" step="0.001" min="0" value="4" />
          </div>
          <div>
            <label for="note">ë©”ëª¨(ì„ íƒ)</label>
            <input id="note" type="text" placeholder="ì˜ˆ: ë¸”í”„ í”„ë¡œëª¨ì…˜ ì„¸íŒ…" />
          </div>
        </div>
        <div class="spacer"></div>
        <div class="inline">
          <button class="btn primary" id="btnCalc">ê³„ì‚°í•˜ê¸°</button>
          <button class="btn" id="btnClear">ì´ˆê¸°í™”</button>
          <span id="calcStatus" class="chip">ëŒ€ê¸° ì¤‘</span>
        </div>
      </div>

      <!-- Result Card -->
      <div class="card" style="grid-column: span 4;">
        <div class="section-title">ê²°ê³¼</div>
        <div id="results">
          <div class="stat"><span>ì´í•©(ARS)</span><strong id="sumARS">0</strong></div>
          <div class="stat"><span>í™˜ì‚°(KRW)</span><strong id="sumKRW">â‚©0</strong></div>
        </div>
        <div class="subtitle" id="feeNote">* ê³„ì‚°ì‹: (ì´í•© ARS Ã— í™˜ìœ¨) + ê³ ì •ìˆ˜ìˆ˜ë£Œ <strong>â‚©1,000</strong> í¬í•¨</div>
        <hr />
        <label for="formatSelect">ìš”ì•½ ë³µì‚¬ í¬ë§·</label>
        <div class="inline">
          <select id="formatSelect">
            <option value="text">í…ìŠ¤íŠ¸</option>
            <option value="md">Markdown</option>
            <option value="discord">Discord</option>
          </select>
          <button class="btn" id="btnCopy">ìš”ì•½ ë³µì‚¬</button>
        </div>
        <div id="copyStatus" class="subtitle" style="margin-top:8px;"></div>
      </div>

      <!-- Preset Card -->
      <div class="card" style="grid-column: span 6;">
        <div class="section-title">í”„ë¦¬ì…‹</div>
        <div class="grid-2">
          <div>
            <label for="presetName">í”„ë¦¬ì…‹ ì´ë¦„</label>
            <input id="presetName" type="text" placeholder="ì˜ˆ: ì›”ì •ì•¡ ê¸°ë³¸" />
          </div>
          <div>
            <label>&nbsp;</label>
            <div class="inline">
              <button class="btn" id="btnSavePreset">í”„ë¦¬ì…‹ ì €ì¥</button>
              <button class="btn danger" id="btnDeletePreset">ì‚­ì œ</button>
            </div>
          </div>
        </div>
        <div class="spacer"></div>
        <label for="presetSelect">í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°</label>
        <div class="inline">
          <select id="presetSelect"></select>
          <button class="btn" id="btnLoadPreset">ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
        <div id="presetStatus" class="subtitle" style="margin-top:8px;"></div>
      </div>

      <!-- History Card -->
      <div class="card" style="grid-column: span 6;">
        <div class="section-title">íˆìŠ¤í† ë¦¬ (ìµœê·¼ 5íšŒ)</div>
        <div class="list" id="historyList"></div>
        <div class="inline" style="margin-top:8px;">
          <button class="btn ghost danger" id="btnClearHistory">íˆìŠ¤í† ë¦¬ ë¹„ìš°ê¸°</button>
        </div>
      </div>

      <!-- Remote Preset Card -->
      <div class="card" style="grid-column: span 12;">
        <div class="section-title">ì›ê²© í”„ë¦¬ì…‹ ê°€ì ¸ì˜¤ê¸° (ì„ íƒ)</div>
        <div class="grid-2">
          <div>
            <label for="remoteUrl">í”„ë¦¬ì…‹ì´ ìˆëŠ” í˜ì´ì§€ URL</label>
            <input id="remoteUrl" type="text" placeholder="ì˜ˆ: https://steampasswordstolez.github.io/AsphaltLegendsMultong/" />
          </div>
          <div>
            <label>&nbsp;</label>
            <div class="inline">
              <button class="btn" id="btnFetchRemote">ê°€ì ¸ì˜¤ê¸°</button>
              <span class="subtitle" id="remoteStatus"></span>
            </div>
          </div>
        </div>
        <div class="subtitle">ì„¤ëª…: ë“œë¡­ë‹¤ìš´ì˜ ì˜µì…˜ í…ìŠ¤íŠ¸(í”„ë¦¬ì…‹ ì´ë¦„)ë¥¼ ì½ì–´ì™€ í”„ë¦¬ì…‹ ëª©ë¡ì— ì¶”ê°€í•©ë‹ˆë‹¤. (ë™ì¼ ì´ë¦„ì€ ê±´ë„ˆëœ€)</div>
      </div>

      <!-- Test Card -->
      <div class="card" style="grid-column: span 12;">
        <div class="section-title">ê°œë°œì ë„êµ¬ Â· í…ŒìŠ¤íŠ¸</div>
        <div class="inline">
          <button class="btn" id="btnRunTests">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
          <span id="testStatus" class="dev">ëŒ€ê¸° ì¤‘</span>
        </div>
        <div class="dev">ì½˜ì†”(DevTools)ì„ ì—´ë©´ ìƒì„¸ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </div>

    </div>
  </div>

  <script>
    // ==== Constants =====
    const PACKS = [29, 70, 142, 284, 714, 1429];
    const LS_KEYS = {
      PRESETS: 'al_calc_presets',
      HISTORY: 'al_calc_history',
      THEME: 'al_calc_theme'
    };

    // ==== Utilities =====
    const fmtARS = (n) => new Intl.NumberFormat('ko-KR', { maximumFractionDigits: 0 }).format(n);
    const fmtKRW = (n) => new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', maximumFractionDigits: 0 }).format(n);
    const nowStr = () => new Date().toLocaleString('ko-KR');

    function readCounts() {
      const counts = {};
      PACKS.forEach(v => {
        counts[v] = parseInt(document.getElementById('pack-' + v).value || '0', 10);
      });
      return counts;
    }

    function applyCounts(counts) {
      PACKS.forEach(v => {
        document.getElementById('pack-' + v).value = counts[v] ?? 0;
      });
    }

    function sumARS(counts, extra) {
      let total = 0;
      PACKS.forEach(v => total += v * (counts[v] || 0));
      total += extra;
      return Math.max(0, Math.round(total));
    }

    function toSummaryObj() {
      const counts = readCounts();
      const extra = Number(document.getElementById('extraARS').value || 0);
      const rate = Number(document.getElementById('rate').value || 0);
      const totalARS = sumARS(counts, extra);
      const totalKRW = Math.round(totalARS * rate + 1000); // +1000ì› ê³ ì • ìˆ˜ìˆ˜ë£Œ í¬í•¨
      return { counts, extra, rate, totalARS, totalKRW, note: document.getElementById('note').value || '' };
    }

    function renderTotals(obj) {
      document.getElementById('sumARS').textContent = fmtARS(obj.totalARS) + ' ARS';
      document.getElementById('sumKRW').textContent = fmtKRW(obj.totalKRW);
    }

    function setStatus(id, text, ok=true) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.style.color = ok ? 'var(--success)' : 'var(--danger)';
    }

    // ==== Packs UI build =====
    (function buildPacks(){
      const root = document.getElementById('packs');
      PACKS.forEach(v => {
        const wrap = document.createElement('div');
        wrap.className = 'pack';
        const left = document.createElement('div');
        left.innerHTML = `<label>íŒ© ${v} ARS</label>`;
        const rightWrap = document.createElement('div');
        rightWrap.className = 'inline';
        const minus = document.createElement('button'); minus.className = 'btn small'; minus.textContent = 'âˆ’';
        const input = document.createElement('input'); input.type = 'number'; input.min = '0'; input.value = '0'; input.id = 'pack-' + v;
        const plus = document.createElement('button'); plus.className = 'btn small'; plus.textContent = '+';
        minus.addEventListener('click', () => { input.value = Math.max(0, (parseInt(input.value||'0',10)-1)); autoCalc(); });
        plus.addEventListener('click', () => { input.value = Math.max(0, (parseInt(input.value||'0',10)+1)); autoCalc(); });
        input.addEventListener('input', autoCalc);
        rightWrap.append(minus, input, plus);
        wrap.append(left, rightWrap);
        root.appendChild(wrap);
      });
    })();

    // ==== Calculation & History =====
    function calculate() {
      const obj = toSummaryObj();
      renderTotals(obj);
      setStatus('calcStatus', 'ê³„ì‚° ì™„ë£Œ â€¢ ' + nowStr());
      pushHistory(obj);
      renderHistory();
      return obj;
    }

    function autoCalc(){
      const obj = toSummaryObj();
      renderTotals(obj);
      setStatus('calcStatus', 'ìë™ ê³„ì‚° â€¢ ì„ì‹œ (íˆìŠ¤í† ë¦¬ ì €ì¥ ì•ˆ ë¨)', true);
    }

    function pushHistory(obj){
      const arr = JSON.parse(localStorage.getItem(LS_KEYS.HISTORY) || '[]');
      arr.unshift({ ...obj, ts: Date.now() });
      const trimmed = arr.slice(0,5);
      localStorage.setItem(LS_KEYS.HISTORY, JSON.stringify(trimmed));
    }

    function renderHistory(){
      const root = document.getElementById('historyList');
      root.innerHTML = '';
      const arr = JSON.parse(localStorage.getItem(LS_KEYS.HISTORY) || '[]');
      if(arr.length===0){
        const empty = document.createElement('div');
        empty.className = 'subtitle';
        empty.textContent = 'ì•„ì§ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.';
        root.appendChild(empty);
        return;
      }
      arr.forEach((h) => {
        const row = document.createElement('div');
        row.className = 'history-item';
        const left = document.createElement('div');
        const parts = [`${new Date(h.ts).toLocaleString('ko-KR')}`];
        if(h.note) parts.push(`ë©”ëª¨: ${h.note}`);
        left.innerHTML = `<div><strong>â‚³ ${fmtARS(h.totalARS)}</strong> â†’ <strong>${fmtKRW(h.totalKRW)}</strong></div>
                          <div class="muted">${parts.join(' â€¢ ')}</div>`;
        const btns = document.createElement('div');
        const load = document.createElement('button'); load.className = 'btn small'; load.textContent = 'ë¶ˆëŸ¬ì˜¤ê¸°';
        load.addEventListener('click', ()=>{ applyCounts(h.counts); document.getElementById('extraARS').value = h.extra; document.getElementById('rate').value = h.rate; document.getElementById('note').value = h.note || ''; calculate(); });
        btns.appendChild(load);
        row.append(left, btns);
        root.appendChild(row);
      });
    }

    // ==== Presets =====
    function getPresets(){ return JSON.parse(localStorage.getItem(LS_KEYS.PRESETS) || '{}'); }
    function savePresets(obj){ localStorage.setItem(LS_KEYS.PRESETS, JSON.stringify(obj)); }

    // ê¸°ë³¸ í”„ë¦¬ì…‹ ì‹œë“œ(ìš”ì²­: Infiniti Black S, NIO EP9, BMW i8 ë“±)
    function seedDefaultPresets(){
      const seed = {
  "Infiniti Project Black S ì‡¼ë£¸": { counts:{29:1,70:2,142:6,284:0,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "NIO EP9 ì‡¼ë£¸": { counts:{29:5,70:1,142:13,284:8,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "BMW i8 ì‡¼ë£¸": { counts:{29:1,70:7,142:6,284:5,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Renault Sport R.S.01 ì‡¼ë£¸": { counts:{29:1,70:1,142:2,284:7,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Lotus Emira ì‡¼ë£¸": { counts:{29:1,70:4,142:7,284:8,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Lamborghini Miura ì‡¼ë£¸": { counts:{29:1,70:0,142:2,284:5,714:3,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Honda Civic Type-R ì‡¼ë£¸": { counts:{29:1,70:2,142:4,284:7,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Renault Dezir ì‡¼ë£¸": { counts:{29:3,70:8,142:6,284:0,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Renault TreZor ì‡¼ë£¸": { counts:{29:1,70:4,142:7,284:5,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Ferrari Monza SP1 ì‡¼ë£¸": { counts:{29:1,70:3,142:5,284:8,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Volkswagen W12 ì‡¼ë£¸": { counts:{29:1,70:0,142:0,284:5,714:2,1429:3}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Lamborghini Sian FKP 37 ì‡¼ë£¸": { counts:{29:1,70:0,142:0,284:10,714:7,1429:11}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Boxwell MK X 500 ì‡¼ë£¸": { counts:{29:1,70:5,142:5,284:6,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Aston Martin V12 Speedstar ì‡¼ë£¸": { counts:{29:2,70:3,142:6,284:5,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Saleen S1 ì‡¼ë£¸": { counts:{29:3,70:4,142:6,284:10,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" },
  "Vanda Dendrobium ì‡¼ë£¸": { counts:{29:7,70:2,142:19,284:13,714:0,1429:0}, extra:0, rate:4, note:"ê¸°ë³¸ ì‡¼ë£¸" }
};
      const existing = getPresets();
      const merged = { ...seed, ...existing }; // ê¸°ì¡´ì´ ìš°ì„ 
      savePresets(merged);
    }

    // ì›ê²© í˜ì´ì§€ì—ì„œ í”„ë¦¬ì…‹ ì´ë¦„ì„ ì¶”ì¶œí•˜ì—¬ ì¶”ê°€
    async function fetchRemotePresets(url){
      const res = await fetch(url, { mode: 'cors' });
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, 'text/html');
      const options = Array.from(doc.querySelectorAll('option'))
        .map(o=>o.textContent.trim())
        .filter(t=>t && !/í”„ë¦¬ì…‹ ì„ íƒ/i.test(t));
      if(options.length===0) return { added:0, names:[] };
      const presets = getPresets();
      let added = 0; const names = [];
      options.forEach(name=>{
        if(!(name in presets)){
          presets[name] = { counts:{29:0,70:0,142:0,284:0,714:0,1429:0}, extra:0, rate:Number(document.getElementById('rate').value||4), note:'ì›ê²©ì—ì„œ ì¶”ê°€' };
          added++; names.push(name);
        }
      });
      savePresets(presets);
      refreshPresetSelect();
      return { added, names };
    }

    function refreshPresetSelect(){
      const sel = document.getElementById('presetSelect');
      sel.innerHTML = '';
      const presets = getPresets();
      const names = Object.keys(presets);
      if(names.length===0){
        const opt = document.createElement('option');
        opt.textContent = 'í”„ë¦¬ì…‹ ì—†ìŒ';
        opt.value = '';
        sel.appendChild(opt);
        return;
      }
      names.forEach(n => {
        const opt = document.createElement('option');
        opt.value = n; opt.textContent = n;
        sel.appendChild(opt);
      });
    }

    // ==== Preset Button Wiring =====
    document.getElementById('btnSavePreset').addEventListener('click', ()=>{
      const name = (document.getElementById('presetName').value || '').trim();
      if(!name){ setStatus('presetStatus','í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', false); return; }
      const obj = toSummaryObj();
      const presets = getPresets();
      presets[name] = obj;
      savePresets(presets);
      refreshPresetSelect();
      setStatus('presetStatus',`í”„ë¦¬ì…‹ "${name}" ì €ì¥ë¨`);
    });

    document.getElementById('btnLoadPreset').addEventListener('click', ()=>{
      const sel = document.getElementById('presetSelect');
      const name = sel.value;
      const presets = getPresets();
      if(!name || !presets[name]){ setStatus('presetStatus','ë¶ˆëŸ¬ì˜¬ í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.', false); return; }
      const p = presets[name];
      applyCounts(p.counts); document.getElementById('extraARS').value = p.extra; document.getElementById('rate').value = p.rate; document.getElementById('note').value = p.note || '';
      calculate();
      setStatus('presetStatus',`í”„ë¦¬ì…‹ "${name}" ë¶ˆëŸ¬ì˜´`);
    });

    document.getElementById('btnDeletePreset').addEventListener('click', ()=>{
      const name = (document.getElementById('presetName').value || document.getElementById('presetSelect').value || '').trim();
      if(!name){ setStatus('presetStatus','ì‚­ì œí•  í”„ë¦¬ì…‹ ì´ë¦„ì„ ì„ íƒ/ì…ë ¥í•˜ì„¸ìš”.', false); return; }
      const presets = getPresets();
      if(!(name in presets)){ setStatus('presetStatus','í•´ë‹¹ ì´ë¦„ì˜ í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.', false); return; }
      delete presets[name];
      savePresets(presets);
      refreshPresetSelect();
      setStatus('presetStatus',`í”„ë¦¬ì…‹ "${name}" ì‚­ì œë¨`);
    });

    document.getElementById('btnFetchRemote').addEventListener('click', async ()=>{
      const url = (document.getElementById('remoteUrl').value||'').trim();
      if(!url){
        document.getElementById('remoteStatus').textContent = 'URLì„ ì…ë ¥í•˜ì„¸ìš”.';
        document.getElementById('remoteStatus').style.color = 'var(--danger)';
        return;
      }
      document.getElementById('remoteStatus').textContent = 'ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
      document.getElementById('remoteStatus').style.color = '';
      try{
        const { added, names } = await fetchRemotePresets(url);
        document.getElementById('remoteStatus').textContent = `${added}ê°œ ì¶”ê°€ë¨` + (names.length?` â€” ${names.join(', ')}`:'');
        document.getElementById('remoteStatus').style.color = 'var(--success)';
      } catch(e){
        document.getElementById('remoteStatus').textContent = 'ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨(CORS ë˜ëŠ” í˜ì´ì§€ êµ¬ì¡° ë³€ê²½)';
        document.getElementById('remoteStatus').style.color = 'var(--danger)';
      }
    });

    // ==== Copy Summary =====
    function buildSummary(obj, mode){
      const lines = [];
      lines.push(`[ìš”ì•½] ì´í•©: ${fmtARS(obj.totalARS)} ARS â†’ ${fmtKRW(obj.totalKRW)} (í™˜ìœ¨ ${obj.rate}, +â‚©1,000 í¬í•¨)`);
      const parts = PACKS.map(v => `${v}Ã—${obj.counts[v]||0}`).join(', ');
      // FIX: ì˜¬ë°”ë¥¸ í…œí”Œë¦¿ ë¦¬í„°ëŸ´/ì‚¼í•­ ì‚¬ìš© (ì´ì „ ì˜¤ë¥˜ ì§€ì )
      lines.push(`íŒ©: ${parts}${obj.extra ? `, ì¶”ê°€ ${fmtARS(obj.extra)} ARS` : ''}`);
      if(obj.note) lines.push(`ë©”ëª¨: ${obj.note}`);

      if(mode==='md'){
        return `**ê²°ì œ ìš”ì•½**\n\n- **ì´í•©**: ${fmtARS(obj.totalARS)} ARS â†’ **${fmtKRW(obj.totalKRW)}** (í™˜ìœ¨ ${obj.rate}, +â‚©1,000 í¬í•¨)\n- **íŒ©**: ${parts}${obj.extra?`\n- **ì¶”ê°€**: ${fmtARS(obj.extra)} ARS`:''}${obj.note?`\n- **ë©”ëª¨**: ${obj.note}`:''}`;
      }
      if(mode==='discord'){
        return `**ê²°ì œ ìš”ì•½**\n\n> ì´í•©: **${fmtARS(obj.totalARS)} ARS â†’ ${fmtKRW(obj.totalKRW)}** (í™˜ìœ¨ ${obj.rate}, +â‚©1,000 í¬í•¨)\n> íŒ©: ${parts}${obj.extra?`\n> ì¶”ê°€: ${fmtARS(obj.extra)} ARS`:''}${obj.note?`\n> ë©”ëª¨: ${obj.note}`:''}`;
      }
      return lines.join('\n');
    }

    document.getElementById('btnCopy').addEventListener('click', async ()=>{
      const obj = toSummaryObj();
      const mode = document.getElementById('formatSelect').value;
      const text = buildSummary(obj, mode);
      try {
        await navigator.clipboard.writeText(text);
        setStatus('copyStatus','í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨');
      } catch(e){
        setStatus('copyStatus','ë³µì‚¬ ì‹¤íŒ¨: ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”', false);
      }
    });

    // ==== Theme handling =====
    function setTheme(mode){
      const html = document.documentElement;
      if(mode==='system'){
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        html.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
      } else {
        html.setAttribute('data-theme', mode);
      }
      localStorage.setItem(LS_KEYS.THEME, mode);
      const sel = document.getElementById('themeSelect');
      if(sel && sel.value !== mode) sel.value = mode;
    }

    const themeSelect = document.getElementById('themeSelect');
    if(themeSelect){
      themeSelect.addEventListener('change', (e)=> setTheme(e.target.value));
    }

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ()=>{
      const mode = localStorage.getItem(LS_KEYS.THEME) || 'system';
      if(mode==='system') setTheme('system');
    });

    // ==== Tests =====
    function runTests(){
      const results = [];
      function ok(cond, msg){ results.push({ ok: !!cond, msg }); if(!cond) console.error('[FAIL]', msg); else console.log('[PASS]', msg); }

      // Test 1: sumARS()
      ok(sumARS({29:1,70:0,142:0,284:0,714:0,1429:0}, 0) === 29, 'sumARS: 29Ã—1 = 29');
      ok(sumARS({29:2,70:1,142:0,284:0,714:0,1429:0}, 5) === 29*2+70+5, 'sumARS: mixed + extra');

      // Test 2: toSummaryObj()
      document.getElementById('pack-29').value = 1;
      document.getElementById('pack-70').value = 0;
      document.getElementById('pack-142').value = 0;
      document.getElementById('pack-284').value = 0;
      document.getElementById('pack-714').value = 0;
      document.getElementById('pack-1429').value = 0;
      document.getElementById('extraARS').value = 0;
      document.getElementById('rate').value = 4;
      const obj = toSummaryObj();
      ok(obj.totalARS === 29, 'toSummaryObj: totalARS correct');
      ok(obj.totalKRW === Math.round(29*4 + 1000), 'toSummaryObj: +1000ì› í¬í•¨ ê³„ì‚°');

      // Test 3: Theme set/get (light/dark)
      setTheme('dark');
      ok(document.documentElement.getAttribute('data-theme') === 'dark', 'Theme switch to dark');
      setTheme('light');
      ok(document.documentElement.getAttribute('data-theme') === 'light', 'Theme switch to light');

      // Test 4: Custom theme switch
      setTheme('aurora');
      ok(document.documentElement.getAttribute('data-theme') === 'aurora', 'Theme switch to aurora');

      // Test 5: buildSummary() - extra í¬í•¨/ë¯¸í¬í•¨ ê²€ì¦
      document.getElementById('extraARS').value = 123;
      const obj2 = toSummaryObj();
      const text = buildSummary(obj2, 'text');
      ok(text.includes('ì¶”ê°€') === true, 'buildSummary(text): extra > 0ì´ë©´ "ì¶”ê°€" í¬í•¨');
      document.getElementById('extraARS').value = 0;
      const obj3 = toSummaryObj();
      const text2 = buildSummary(obj3, 'text');
      ok(text2.includes('ì¶”ê°€') === false, 'buildSummary(text): extra = 0ì´ë©´ "ì¶”ê°€" ë¯¸í¬í•¨');

      const pass = results.every(r=>r.ok);
      setStatus('testStatus', pass ? `ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (${results.length}/${results.length})` : `ì¼ë¶€ ì‹¤íŒ¨ (${results.filter(r=>r.ok).length}/${results.length})`, pass);
    }

    document.getElementById('btnRunTests').addEventListener('click', runTests);

    // ==== Wiring =====
    document.getElementById('btnCalc').addEventListener('click', calculate);
    document.getElementById('btnClear').addEventListener('click', ()=>{
      applyCounts({});
      document.getElementById('extraARS').value = 0;
      document.getElementById('rate').value = 4;
      document.getElementById('note').value = '';
      renderTotals({ totalARS:0, totalKRW:0 });
      setStatus('calcStatus','ì´ˆê¸°í™” ì™„ë£Œ');
    });

    document.getElementById('btnClearHistory').addEventListener('click', ()=>{
      localStorage.removeItem(LS_KEYS.HISTORY);
      renderHistory();
    });

    // Auto-calc bindings
    document.getElementById('extraARS').addEventListener('input', autoCalc);
    document.getElementById('rate').addEventListener('input', autoCalc);

    // ==== Init =====
    (function init(){
      seedDefaultPresets();
      refreshPresetSelect();
      renderHistory();
      const savedTheme = localStorage.getItem(LS_KEYS.THEME) || 'system';
      setTheme(savedTheme);
      const sel = document.getElementById('themeSelect');
      if(sel) sel.value = savedTheme;
      autoCalc();
      const remote = document.getElementById('remoteUrl');
      if(remote) remote.value = 'https://steampasswordstolez.github.io/AsphaltLegendsMultong/';
    })();
  </script>

<!-- v1.4.0 â€” EV Simulator (Monte Carlo) -->
<style id="ev-sim-style">
#ev-sim { margin-top: 24px; border-radius: 12px; padding: 16px; background: color-mix(in oklab, var(--card) 85%, black 15%); border: 1px solid var(--border); }
#ev-sim h2 { margin: 0 0 12px; font-size: 1.1rem; }
#ev-sim .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
#ev-sim label { font-size: .9rem; opacity: .9; display:block; margin-bottom: 4px; }
#ev-sim input[type="number"] { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--fg); }
#ev-sim .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
#ev-sim .btn { padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); cursor:pointer; }
#ev-sim .statbox { display:grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap:10px; margin-top:12px;}
#ev-sim .statitem { padding:10px; border-radius:10px; background: color-mix(in oklab, var(--card) 80%, black 20%); border:1px solid var(--border); }
#ev-sim .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
#ev-sim small.hint { opacity:.75; }
#ev-sim details { margin-top: 12px; }
#ev-sim pre { max-height: 260px; overflow: auto; padding: 10px; background: color-mix(in oklab, var(--card) 80%, black 20%); border:1px solid var(--border); border-radius:10px; }
</style>


<!-- v1.5.0 Fullstar Expectation Simulator (interactive) -->
<section id="ev-sim" class="card">
  <h3>í’€ì„± ê¸°ëŒ“ê°’ ì‹œë®¬ë ˆì´í„° (v1.5.0)</h3>
  <p style="font-size:0.9rem; color:#ffcc00; opacity:0.85; margin-top:-4px;">âš ï¸ ë³¸ ì‹œë®¬ë ˆì´ì…˜ì€ ëª¨ë°”ì¼ í™˜ê²½ì—ì„œì˜ ì‚¬ìš©ì´ ì›í™œí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. PC ì´ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
  <div class="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;">
    <label>ğŸŸï¸ íŒ© ê°€ê²© (í† í°)
      <input id="packPrice" type="number" min="0" value="75">
    </label>
    <label>ğŸ“ˆ 3ì¥ í™•ë¥  (%)
      <input id="prob3" type="number" min="0" max="100" step="0.1" value="19.9">
    </label>
    <label>ğŸŒŸ 15ì¥ í™•ë¥  (%)
      <input id="prob15" type="number" min="0" max="100" step="0.01" value="0.1">
    </label>
    <label>ğŸ§© 1ëŒ€ í’€ì„± ì²­ì‚¬ì§„ ìˆ˜
      <input id="needCards" type="number" min="1" value="300">
    </label>
    <label>ğŸ” ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜
      <input id="numSim" type="number" min="100" value="1000">
    </label>
    <label>ğŸš— ì°¨ëŸ‰ ìˆ˜
      <input id="carCount" type="number" min="1" value="6">
    </label>
  
    <label>ğŸ§© ì°¨ëŸ‰ë³„ í•„ìš” ì²­ì‚¬ì§„ (ì‰¼í‘œ êµ¬ë¶„)
      <input id="needCardsList" type="text" placeholder="ì˜ˆ: 300,280,360 (ë¹„ì›Œë‘ë©´ ìœ„ ê°’ ì‚¬ìš©)">
    </label>
    
  </div>
  <div class="row" style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
    <button class="btn primary" onclick="runFullstarSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
    <small class="hint" style="opacity:.8">10ì—°ë½‘ ë§ˆì§€ë§‰ ì¹´ë“œ í™•ì •: [3ì¥ 78.9266%, 15ì¥ 21.0734%] ê°€ì •</small>
  </div>
  <div id="ev-output" class="stat" style="margin-top:10px;font-family:ui-monospace,Menlo,Consolas,monospace;"></div>
</section>

<script>
function simulateCardDrawing(cardPackPrice, cardProbabilities, needingCards) {
  const cards = ["losing card", "3 cards", "15 cards"];
  const tencardProbabilities = [0.789266, 0.210734]; // 10ì—° ë§ˆì§€ë§‰ í™•ì •
  let totalTokensSpent = 0;
  let totalCardsObtained = 0;
  let currentDrawnNumber = 0;
  const tencard = cards.slice(1);

  while (totalCardsObtained < needingCards) {
    totalTokensSpent += cardPackPrice;
    const sumProb = cardProbabilities[0] + cardProbabilities[1] + cardProbabilities[2];
    const r = Math.random() * sumProb;
    let cum = 0;
    let drawnCard = cards[0];

    if (currentDrawnNumber === 9) {
      // 10ì—° ë§ˆì§€ë§‰ í™•ì •
      for (let i=0;i<tencard.length;i++) {
        cum += tencardProbabilities[i];
        if (r < cum) {
          currentDrawnNumber = 0;
          drawnCard = tencard[i];
          break;
        }
      }
    } else {
      // ì¼ë°˜ í™•ë¥ 
      for (let i=0;i<cards.length;i++) {
        cum += cardProbabilities[i];
        if (r < cum) {
          currentDrawnNumber++;
          drawnCard = cards[i];
          break;
        }
      }
    }
    if (drawnCard === "3 cards") totalCardsObtained += 3;
    else if (drawnCard === "15 cards") totalCardsObtained += 15;
  }
  return totalTokensSpent;
}

function calculateStandardDeviation(data) {
  const mean = data.reduce((a,b)=>a+b,0) / data.length;
  const variance = data.reduce((a,b)=>a+(b-mean)**2,0) / data.length;
  return Math.sqrt(variance);
}

function runSimulations(numSimulations, cardPackPrice, cardProbabilities, needingCards) {
  const results = new Array(numSimulations);
  for (let i=0;i<numSimulations;i++) {
    results[i] = simulateCardDrawing(cardPackPrice, cardProbabilities, needingCards);
  }
  const sum = results.reduce((a,b)=>a+b,0);
  const avg = sum / results.length;
  const std = calculateStandardDeviation(results);
  return {avg, std};
}


function runFullstarSimulation() {
  const price = Math.max(0, parseFloat(document.getElementById("packPrice").value || "75"));
  const prob3 = Math.max(0, Math.min(100, parseFloat(document.getElementById("prob3").value || "19.9"))) / 100;
  const prob15 = Math.max(0, Math.min(100, parseFloat(document.getElementById("prob15").value || "0.1"))) / 100;
  const probLose = Math.max(0, 1 - prob3 - prob15);
  const defaultNeed = Math.max(1, parseInt(document.getElementById("needCards").value || "300", 10));
  const numSim = Math.max(100, parseInt(document.getElementById("numSim").value || "1000", 10));
  const carCountInput = Math.max(1, parseInt(document.getElementById("carCount").value || "6", 10));
  const needListRaw = (document.getElementById("needCardsList").value || "").trim();

  const cardProbabilities = [probLose, prob3, prob15];

  // Parse list like "300,280,360"
  let needs = [];
  if (needListRaw.length > 0) {
    needs = needListRaw.split(",").map(s => parseInt(s.trim(), 10)).filter(n => !isNaN(n) && n > 0);
  }
  if (needs.length === 0) {
    // no list provided -> use carCount copies of defaultNeed
    needs = Array.from({length: carCountInput}, () => defaultNeed);
  }

  // Run per-car simulations and aggregate
  const perCar = needs.map((need, idx) => {
    const res = runSimulations(numSim, price, cardProbabilities, need);
    return { car: idx+1, need, avg: res.avg, std: res.std };
  });

  const totalAvg = perCar.reduce((a,v)=>a+v.avg, 0);
  const carCount = perCar.length;

  // Render output table
  let rows = perCar.map(v => `#${v.car} (í•„ìš” ${v.need}) â†’ í‰ê·  ${v.avg.toFixed(2)} | Ïƒ ${v.std.toFixed(2)}`).join("<br>");
  if (rows.length === 0) rows = "(ê²°ê³¼ ì—†ìŒ)";

  document.getElementById("ev-output").innerHTML = [
    `<b>ğŸ“Š ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ (${numSim}íšŒ í‰ê· , ì°¨ëŸ‰ ${carCount}ëŒ€)</b>`,
    rows,
    `<hr style="opacity:.3">ì´ í† í° ì†Œëª¨ (í‰ê·  í•©ê³„): <b>${totalAvg.toFixed(2)}</b>`
  ].join("<br>");
}
</script>


<script id="ev-sim-script">
(function(){
  function rand() { return Math.random(); }

  function simulateOne(cfg){
    const cars = new Array(cfg.cars).fill(0);
    let draws = 0;
    const need = cfg.needPerCar;
    const dropP = cfg.dropRate;
    while(true){
      draws++;
      if (rand() < dropP){
        // which car? uniform among those not yet finished (or simply uniform overall to mimic in-game split)
        let idx = Math.floor(rand()*cfg.cars);
        // shards amount
        const shards = (rand() < cfg.jackpotP)? cfg.shardsJP : cfg.shardsNorm;
        cars[idx] += shards;
      }
      // done?
      let complete = true;
      for (let i=0;i<cfg.cars;i++){
        if (cars[i] < need){ complete = false; break; }
      }
      if (complete) return draws;
    }
  }

  function mean(arr){ return arr.reduce((a,b)=>a+b,0)/arr.length; }
  function variance(arr, m){ let s=0; for(const x of arr){ const d=x-m; s+=d*d;} return s/(arr.length-1); }
  function stddev(v){ return Math.sqrt(v); }

  window.runEVSim = function(){
    const cfg = {
      cars: Math.max(1, parseInt(document.getElementById('ev_cars').value||'3',10)),
      dropRate: Math.max(0, Math.min(1, parseFloat(document.getElementById('ev_drop').value||'20')/100)),
      jackpotP: Math.max(0, Math.min(1, parseFloat(document.getElementById('ev_jackpot').value||'2')/100)),
      shardsNorm: Math.max(1, parseInt(document.getElementById('ev_shards_norm').value||'3',10)),
      shardsJP: Math.max(1, parseInt(document.getElementById('ev_shards_jp').value||'15',10)),
      needPerCar: Math.max(1, parseInt(document.getElementById('ev_need_per_car').value||'60',10)),
      trials: Math.max(100, parseInt(document.getElementById('ev_trials').value||'5000',10)),
      costPerDraw: Math.max(0, parseFloat(document.getElementById('ev_cost_per_draw').value||'0'))
    };
    const runs = new Array(cfg.trials);
    // Monte Carlo
    for (let t=0; t<cfg.trials; t++){
      runs[t] = simulateOne(cfg);
    }
    const m = mean(runs);
    const v = variance(runs, m);
    const s = stddev(v);
    const ciHalf = 1.96 * s / Math.sqrt(cfg.trials);
    const ci = [m - ciHalf, m + ciHalf];

    // Output
    const out = (id, val)=>document.getElementById(id).textContent = (typeof val === 'number'? Math.round(val*100)/100 : val);
    document.getElementById('ev_out').style.display = 'grid';
    out('ev_mean', m);
    out('ev_std', s);
    out('ev_var', v);
    out('ev_ci', `${(ci[0]).toFixed(2)} ~ ${(ci[1]).toFixed(2)}`);

    if (cfg.costPerDraw > 0){
      const avgCost = m * cfg.costPerDraw;
      document.getElementById('ev_cost_wrap').style.display = 'block';
      out('ev_cost', avgCost);
    } else {
      document.getElementById('ev_cost_wrap').style.display = 'none';
    }

    // Log sample (first 50)
    const sample = runs.slice(0, Math.min(50, runs.length)).map((v,i)=>`${i+1}: ${v}`).join('\n');
    document.getElementById('ev_log').textContent = sample;
  };
})();
</script>


<!-- v1.4.2 select visibility fix -->
<style id="select-visibility-fix">
/* ì„ íƒì§€(ë“œë¡­ë‹¤ìš´/ì˜µì…˜) ê°€ì‹œì„± ê³ ì • */
select,
select option,
.dropdown-menu,
.listbox,
.menu {
  background-color: #111318 !important; /* ê³ ì • ì–´ë‘ìš´ ë°°ê²½ */
  color: #f5f7fa !important;            /* ê³ ì • ë°ì€ ì „ê²½ */
  border: 1px solid rgba(255,255,255,0.15) !important;
}

/* hover/focus ì‹œ ì‹œì¸ì„± ê°•í™” */
select:focus,
select:hover {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* ì˜µì…˜ hover/ì„ íƒ ê°€ì‹œì„± (ë¸Œë¼ìš°ì €ë³„ ì§€ì› ì°¨ì´ ì¡´ì¬) */
select option:hover,
select option:checked {
  background-color: #1b1e24 !important;
  color: #ffffff !important;
}
</style>


<!-- v1.4.3 responsive layout fix -->
<style id="responsive-layout-fix">
/* ëª¨ë°”ì¼ ì „ì²´ í°íŠ¸ ë° ì¹´ë“œ ì—¬ë°± ì¡°ì • */
@media (max-width: 768px) {
  body {
    font-size: 15px;
    line-height: 1.4;
  }

  .card {
    width: 94% !important;
    margin: 10px auto !important;
    padding: 10px !important;
  }

  /* ë“œë¡­ë‹¤ìš´, ë²„íŠ¼ í¬ê¸° ìë™ ì¡°ì • */
  select, input[type="number"], input[type="text"], button {
    font-size: 14px !important;
    padding: 6px 8px !important;
  }

  /* í”„ë¦¬ì…‹/ê³„ì‚°ê¸°/íˆìŠ¤í† ë¦¬ ì˜ì—­ì´ í•œ ì¤„ì— í•˜ë‚˜ì”© */
  .grid, .row, .controls, .history, .preset {
    display: block !important;
  }

  /* ë²„íŠ¼ ê·¸ë£¹ ê°„ê²© ì •ë¦¬ */
  .btn {
    display: block;
    width: 100%;
    margin-bottom: 8px;
  }

  /* í‘œ/ë¦¬ìŠ¤íŠ¸ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
  table, .history-list {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* ì´ˆì†Œí˜• í™”ë©´(ì•„ì´í° SE ì´í•˜) */
@media (max-width: 420px) {
  body { font-size: 14px; }
  .card { padding: 8px !important; }
  button, select { font-size: 13px !important; }
}
</style>


<!-- v1.4.3a responsive numeric layout restore -->
<style id="responsive-layout-fix-a">
@media (max-width: 768px) {
  /* ìˆ«ì ì…ë ¥/íŒ© ìˆ˜/í•©ê³„ ë“±ì´ í•œ ì¤„ë¡œ ë³´ì´ë„ë¡ flex ë³µì› */
  .controls, .row {
    display: flex !important;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }
  /* ì…ë ¥ í­ì´ ë„ˆë¬´ ì¢ì•„ì§€ì§€ ì•Šë„ë¡ ìµœì†Œ í­ í™•ë³´ */
  input[type="number"], input[type="text"], select {
    min-width: 92px;
  }
  /* ìˆ«ìÂ·ë‹¨ìœ„ê°€ ëŠê¸°ì§€ ì•Šê²Œ */
  .mono, .stat, .statitem, .qty, .amount {
    white-space: nowrap;
  }
}
</style>


<!-- v1.4.3b mobile overflow fix -->
<style id="responsive-layout-fix-b">
@media (max-width: 768px) {
  body {
    overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
  }

  .controls, .row {
    display: flex !important;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    margin: 4px 0;
  }

  /* ë¹„ìœ¨ ê¸°ë°˜ ìµœì†Œí­ìœ¼ë¡œ ìë™ ì¤„ë§ì¶¤ (ë„˜ì¹¨ ë°©ì§€) */
  input[type="number"], input[type="text"], select {
    min-width: 22%;
    max-width: 48%;
    flex: 1 1 auto;
  }

  /* ìˆ«ìÂ·ë‹¨ìœ„ ì¤„ë°”ê¿ˆ ë°©ì§€ */
  .mono, .stat, .statitem, .qty, .amount {
    white-space: nowrap;
  }

  /* ì¹´ë“œ í­ì€ í•­ìƒ í™”ë©´ ì•ˆì—ì„œ */
  .card {
    width: calc(100% - 20px) !important;
    margin: 10px auto !important;
  }
}
</style>


<!-- v1.5.2 polished UI system -->
<style id="polished-ui-v1-5-2">
/* ===== Design Tokens ===== */
:root{
  --radius: 12px;
  --radius-sm: 10px;
  --gap: 12px;
  --gap-sm: 8px;
  --elev-1: 0 6px 18px rgba(0,0,0,.25);
  --elev-2: 0 12px 28px rgba(0,0,0,.28);
  --accent: var(--accent, #7c3aed); /* fallback to purple */
  --accent-contrast: #ffffff;
  --muted: rgba(255,255,255,.65);
  --fg-num: #e8ecf3;
}

/* Typographic scale */
h1,h2,h3 { letter-spacing: -0.01em }
.card h1{ font-size: clamp(1.4rem, 2.2vw, 1.9rem) }
.card h2{ font-size: clamp(1.2rem, 2.0vw, 1.5rem) }
.card h3{ font-size: clamp(1.1rem, 1.8vw, 1.25rem) }

/* ===== Cards ===== */
.card{
  border-radius: var(--radius);
  box-shadow: var(--elev-1);
  border: 1px solid var(--border);
  background: color-mix(in oklab, var(--card) 86%, black 14%);
}

/* ===== Consistent Control Rows ===== */
.controls, .row{
  display: grid;
  gap: var(--gap);
  grid-template-columns: repeat(12, 1fr);
  align-items: center;
}
/* Pack lines look symmetrical: [label] [â€”] [input] [+] [spacer] [per-pack total] */
.controls .label, .row .label{ grid-column: span 4; font-weight: 600; opacity:.9 }
.controls .minus, .row .minus{ grid-column: span 1; }
.controls .qty,   .row .qty  { grid-column: span 2; }
.controls .plus,  .row .plus { grid-column: span 1; }
.controls .spacer,.row .spacer { grid-column: span 1; }
.controls .total, .row .total{ grid-column: span 3; text-align:right; color: var(--fg-num) }

/* When DOM doesn't have these classes, align common elements by order as a fallback */
.controls > *:nth-child(1){ }
.controls > *:nth-child(2){ }
.controls > *:nth-child(3){ }
.controls > *:nth-child(4){ }
.controls > *:nth-child(5){ }
.controls > *:nth-child(6){ text-align:right }

/* Numbers look crisp */
input[type="number"]{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight: 600; color: var(--fg-num) }

/* ===== Button System ===== */
.btn{
  display:inline-flex; align-items:center; justify-content:center;
  height: 36px; padding: 0 14px; border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: color-mix(in oklab, var(--card) 86%, black 14%);
  color: var(--fg); cursor: pointer; user-select:none;
  transition: transform .08s ease, box-shadow .08s ease, border-color .12s ease, background .12s ease;
}
.btn:hover{ transform: translateY(-1px); box-shadow: var(--elev-1); border-color: color-mix(in oklab, var(--accent) 60%, white 10%); }
.btn:active{ transform: translateY(0); box-shadow: none; }

/* Role-based buttons */
.btn.primary{ background: var(--accent); color: var(--accent-contrast); border-color: var(--accent) }
.btn.secondary{ background: color-mix(in oklab, var(--card) 80%, black 20%); }
.btn.ghost{ background: transparent; border-color: rgba(255,255,255,.16); color: var(--muted) }
.btn.danger{ background: #ef4444; border-color:#ef4444; color:#fff }

/* Icon +/- buttons consistent square size */
.btn.square{ width:38px; height:38px; padding:0; font-weight:700 }

/* Larger CTAs for main actions */
.btn.cta{ height: 42px; padding: 0 18px; font-weight: 700; }

/* ===== Selects / Inputs ===== */
select, input[type="number"], input[type="text"]{
  height: 38px; padding: 0 10px; border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: color-mix(in oklab, var(--card) 86%, black 14%);
  color: var(--fg);
}

/* ===== Result block left-aligned with subtle divider ===== */
#summary, #ev-output{
  text-align:left;
}
.divider{ height:1px; background: rgba(255,255,255,.12); margin: 8px 0 10px 0; border-radius:999px }

/* ===== Responsive ===== */
@media (max-width: 1024px){
  .controls, .row{ grid-template-columns: repeat(8, 1fr) }
  .controls .label, .row .label{ grid-column: span 4 }
  .controls .minus, .row .minus{ grid-column: span 1 }
  .controls .qty, .row .qty{ grid-column: span 2 }
  .controls .plus, .row .plus{ grid-column: span 1 }
  .controls .total, .row .total{ grid-column: span 8; text-align:left }
}
@media (max-width: 640px){
  .controls, .row{ grid-template-columns: repeat(6, 1fr) }
  .controls .label, .row .label{ grid-column: span 6 }
  .controls .minus, .row .minus{ grid-column: span 1 }
  .controls .qty, .row .qty{ grid-column: span 3 }
  .controls .plus, .row .plus{ grid-column: span 1 }
  .controls .total, .row .total{ grid-column: span 6; text-align:left }
  .btn{ height: 34px }
  .btn.square{ width:34px; height:34px }
}
</style>


<!-- v1.5.2a number align fix -->
<style id="number-center-fix">
input[type="number"] {
  text-align: center;
  vertical-align: middle;
  line-height: normal;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 38px;
  padding: 0;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  margin: 0;
  appearance: none;
}
</style>


<!-- v1.5.2a+ button press glow -->
<style id="button-press-feedback">
/* Base */
.btn{ position: relative; overflow: hidden; transition: transform .06s ease, filter .12s ease, box-shadow .12s ease; }
.btn:active{ transform: translateY(0) scale(0.99); }
/* Focus ring */
.btn:focus-visible{ outline: 2px solid var(--accent); outline-offset: 2px;
  box-shadow: 0 0 0 6px color-mix(in oklab, var(--accent) 35%, transparent 65%); }
/* Neon-ish brighten on press */
.btn.primary:active{ filter: brightness(1.14); box-shadow: 0 10px 28px color-mix(in oklab, var(--accent) 45%, transparent 55%); }
.btn.secondary:active{ filter: brightness(1.1); }
/* Ripple/glow */
.btn::after{
  content: "";
  position: absolute; inset: -2px;
  border-radius: inherit; pointer-events: none; opacity: 0;
  background: radial-gradient(180px 180px at var(--press-x,50%) var(--press-y,50%),
    color-mix(in oklab, var(--accent) 60%, white 10%),
    transparent 60%);
  transform: scale(0.5);
}
.btn._press::after{ animation: press-glow .45s ease-out; }
@keyframes press-glow{
  0%{ opacity:.35; transform: scale(0.5); }
  100%{ opacity:0; transform: scale(1.2); }
}
</style>

<script id="button-press-feedback-js">
(function(){
  // Attach once
  const attach = (btn)=>{
    if(btn._pressBound) return;
    btn._pressBound = true;
    btn.addEventListener('pointerdown', (e)=>{
      const rect = btn.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(2) + '%';
      const y = ((e.clientY - rect.top) / rect.height * 100).toFixed(2) + '%';
      btn.style.setProperty('--press-x', x);
      btn.style.setProperty('--press-y', y);
      // retrigger animation
      btn.classList.remove('_press');
      // Force reflow
      void btn.offsetWidth;
      btn.classList.add('_press');
    });
  };
  document.querySelectorAll('.btn').forEach(attach);
  // Observe future buttons just in case
  const obs = new MutationObserver(muts=>{
    muts.forEach(m=>{
      m.addedNodes && m.addedNodes.forEach(n=>{
        if(!(n instanceof Element)) return;
        if(n.classList && n.classList.contains('btn')) attach(n);
        n.querySelectorAll && n.querySelectorAll('.btn').forEach(attach);
      });
    });
  });
  obs.observe(document.documentElement, {childList:true, subtree:true});
})();
</script>


<!-- v1.5.3 neon-themed primary buttons -->
<style id="neon-themed-buttons">
/* Fallback (no theme): use --accent if present */
.btn.primary{
  background: linear-gradient(145deg, var(--accent, #7c3aed), color-mix(in oklab, var(--accent, #7c3aed) 60%, black 40%));
  color: #ffffff;
  text-shadow: 0 0 6px color-mix(in oklab, var(--accent, #7c3aed) 80%, white 20%);
  box-shadow: 0 0 10px color-mix(in oklab, var(--accent, #7c3aed) 50%, transparent 50%);
}

/* === Themed neon palettes === */
/* Onyx (dark cyber blue) */
body[data-theme="onyx"] .btn.primary{
  background: linear-gradient(145deg, #00eaff, #0077ff);
  color: #e9ffff;
  text-shadow: 0 0 6px #00baff, 0 0 14px #00eaff;
  box-shadow: 0 0 14px rgba(0,234,255,0.75), 0 0 36px rgba(0,119,255,0.5);
}
body[data-theme="onyx"] .btn.primary:hover{ filter: brightness(1.2); box-shadow: 0 0 18px rgba(0,234,255,0.95), 0 0 48px rgba(0,119,255,0.6); }
body[data-theme="onyx"] .btn.primary:active{ filter: brightness(1.35); text-shadow: 0 0 10px #00eaff, 0 0 20px #00eaff; }

/* Sunset (warm orange neon) */
body[data-theme="sunset"] .btn.primary{
  background: linear-gradient(145deg, #ff7849, #ffb199);
  color: #fff7f0;
  text-shadow: 0 0 6px #ffb199, 0 0 14px #ff7849;
  box-shadow: 0 0 14px rgba(255,120,73,0.78), 0 0 36px rgba(255,177,153,0.5);
}
body[data-theme="sunset"] .btn.primary:hover{ filter: brightness(1.18); box-shadow: 0 0 18px rgba(255,120,73,0.95), 0 0 48px rgba(255,177,153,0.6); }
body[data-theme="sunset"] .btn.primary:active{ filter: brightness(1.32); text-shadow: 0 0 10px #ffb199, 0 0 20px #ff7849; }

/* Neon Night (magenta/pink neon) */
body[data-theme="neon-night"] .btn.primary{
  background: linear-gradient(145deg, #ff00ff, #ff66ff);
  color: #fff0ff;
  text-shadow: 0 0 8px #ff66ff, 0 0 18px #ff00ff;
  box-shadow: 0 0 18px rgba(255,0,255,0.85), 0 0 40px rgba(255,102,255,0.6);
}
body[data-theme="neon-night"] .btn.primary:hover{ filter: brightness(1.18); box-shadow: 0 0 22px rgba(255,0,255,1), 0 0 52px rgba(255,102,255,0.75); }
body[data-theme="neon-night"] .btn.primary:active{ filter: brightness(1.33); text-shadow: 0 0 12px #ff66ff, 0 0 24px #ff00ff; }

/* Aurora (mint/cyan neon) */
body[data-theme="aurora"] .btn.primary{
  background: linear-gradient(145deg, #00ffc3, #00b3ff);
  color: #eafffb;
  text-shadow: 0 0 8px #99fff2, 0 0 18px #00ffc3;
  box-shadow: 0 0 16px rgba(0,255,195,0.8), 0 0 38px rgba(0,179,255,0.55);
}
body[data-theme="aurora"] .btn.primary:hover{ filter: brightness(1.18); box-shadow: 0 0 20px rgba(0,255,195,1), 0 0 50px rgba(0,179,255,0.7); }
body[data-theme="aurora"] .btn.primary:active{ filter: brightness(1.32); text-shadow: 0 0 12px #99fff2, 0 0 24px #00ffc3; }

/* Forest (neon green) */
body[data-theme="forest"] .btn.primary{
  background: linear-gradient(145deg, #3dfc7e, #00c853);
  color: #edfff3;
  text-shadow: 0 0 6px #88ffb3, 0 0 14px #3dfc7e;
  box-shadow: 0 0 14px rgba(61,252,126,0.8), 0 0 36px rgba(0,200,83,0.5);
}
body[data-theme="forest"] .btn.primary:hover{ filter: brightness(1.18); box-shadow: 0 0 18px rgba(61,252,126,1), 0 0 48px rgba(0,200,83,0.65); }
body[data-theme="forest"] .btn.primary:active{ filter: brightness(1.3); text-shadow: 0 0 10px #88ffb3, 0 0 22px #3dfc7e; }

/* Chroma Glow (purple plasma) */
body[data-theme="chroma"] .btn.primary{
  background: linear-gradient(145deg, #7c3aed, #a78bfa);
  color: #f6f1ff;
  text-shadow: 0 0 8px #b794f6, 0 0 18px #7c3aed;
  box-shadow: 0 0 16px rgba(124,58,237,0.8), 0 0 40px rgba(167,139,250,0.55);
}
body[data-theme="chroma"] .btn.primary:hover{ filter: brightness(1.18); box-shadow: 0 0 20px rgba(124,58,237,1), 0 0 52px rgba(167,139,250,0.7); }
body[data-theme="chroma"] .btn.primary:active{ filter: brightness(1.32); text-shadow: 0 0 12px #b794f6, 0 0 24px #7c3aed; }

/* Light theme (cool blue) */
body[data-theme="light"] .btn.primary{
  background: linear-gradient(145deg, #0077ff, #66bfff);
  color: #f7fbff;
  text-shadow: 0 0 6px #66bfff, 0 0 14px #0077ff;
  box-shadow: 0 0 14px rgba(0,119,255,0.65), 0 0 36px rgba(102,191,255,0.45);
}
body[data-theme="light"] .btn.primary:hover{ filter: brightness(1.15); box-shadow: 0 0 18px rgba(0,119,255,0.9), 0 0 48px rgba(102,191,255,0.6); }
body[data-theme="light"] .btn.primary:active{ filter: brightness(1.28); text-shadow: 0 0 10px #66bfff, 0 0 22px #0077ff; }
</style>


<!-- v1.5.3a label clamp + number font -->
<style id="label-and-number-typography">
/* Make numeric inputs more legible */
input[type="number"]{
  font-family: "Inter", "Noto Sans KR", ui-monospace, Menlo, Consolas, monospace;
  font-weight: 700;
  font-size: 1.25rem; /* bigger digits */
  letter-spacing: .3px;
  text-align: center;
  color: #fff;
}

/* Label: prevent awkward wrapping without overflow by splitting unit */
.label{
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;        /* keep single line */
  min-width: 0;
  max-width: 14ch;            /* clamp width */
  overflow: hidden;
  text-overflow: ellipsis;    /* if too long, ellipsis */
}

/* After we split into main/unit spans */
.label .label-main{ flex: 0 1 auto; min-width: 0; }
.label .label-unit{ flex: 0 0 auto; font-size: .85em; opacity: .75; }

/* Responsive: on very narrow screens, hide the unit to keep one line */
@media (max-width: 640px){
  .label{ max-width: 11ch; }
  .label .label-unit{ display:none; }
}

/* Slightly compact the pack control cluster so the line height stays tight */
.btn.square{ min-width: 36px; height: 36px; }
</style>

<!-- v1.5.3a: runtime label splitter (e.g., "íŒ© 29 ARS" -> "íŒ© 29" + "ARS") -->
<script id="label-runtime-splitter">
(function(){
  const sel = document.querySelectorAll('.label');
  sel.forEach(el => {
    if (el.querySelector('.label-main')) return; // already processed
    const txt = (el.textContent || '').trim();
    // Try to split by the last space to extract unit like 'ARS'
    const idx = txt.lastIndexOf(' ');
    if (idx > 0){
      const main = txt.slice(0, idx).trim();
      const unit = txt.slice(idx+1).trim();
      // Build structure
      el.setAttribute('title', txt); // tooltip for full text
      el.textContent = '';
      const s1 = document.createElement('span'); s1.className = 'label-main'; s1.textContent = main;
      const s2 = document.createElement('span'); s2.className = 'label-unit'; s2.textContent = unit;
      el.appendChild(s1); el.appendChild(s2);
    }
  });
})();
</script>


<!-- v1.5.3b mobile readability boost -->
<style id="mobile-readability-boost">
/* General touch friendliness */
@media (max-width: 640px){
  html, body { font-size: 16px; -webkit-text-size-adjust: 100%; }
  body { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
  .card { padding: 12px !important; }

  /* Pack control row spacing */
  .row, .controls { gap: 8px !important; }

  /* Labels: slightly bigger and stronger; unit hidden already in 640 rule */
  .label { font-size: 0.98rem; font-weight: 700; max-width: 13ch; }

  /* Number inputs: bigger digits & targets */
  input[type="number"]{
    height: 44px !important;
    width: 86px !important;
    font-size: 1.35rem !important;
    font-weight: 800 !important;
    letter-spacing: 0.2px;
  }

  /* Plus/Minus buttons: Apple HIG min 44px */
  .btn.square{
    width: 44px !important;
    height: 44px !important;
    font-size: 1.05rem !important;
  }

  /* Primary buttons (e.g., ê³„ì‚°í•˜ê¸°): larger & full-width option on small screens */
  .btn.primary{
    height: 48px;
    padding: 0 20px;
    font-size: 1rem;
  }
  /* If inside a row of actions, allow wrapping to full width when narrow */
  .actions, .action-row { display:flex; flex-wrap:wrap; gap:8px }
  .actions .btn.primary, .action-row .btn.primary { flex: 1 1 100%; }
  
  /* Result blocks: line-height a bit larger for readability */
  #ev-output, #summary { line-height: 1.6; font-size: 1rem; }
}

/* Very small devices */
@media (max-width: 380px){
  .label { max-width: 10ch; }
  input[type="number"]{ width: 78px !important; font-size: 1.28rem !important; }
  .btn.square{ width: 42px !important; height: 42px !important; }
}

/* Improve contrast slightly for digits on dark backgrounds */
input[type="number"]{
  color: #fff;
  text-shadow: 0 0 1px rgba(0,0,0,0.15);
}
</style>


<!-- v1.5.4 neon colors per theme -->
<style id="v154-themed-neon">
/* Default */
.btn.primary{
  transition: all 0.25s ease-in-out;
  text-shadow: 0 0 6px var(--accent, #7c3aed);
  box-shadow: 0 0 12px color-mix(in oklab, var(--accent, #7c3aed) 70%, transparent 30%);
}

/* Onyx */
body[data-theme="onyx"] .btn.primary{
  background: linear-gradient(145deg, #00eaff, #0077ff);
  color: #e9ffff;
  text-shadow: 0 0 8px #00eaff, 0 0 20px #0077ff;
  box-shadow: 0 0 16px rgba(0,234,255,0.8), 0 0 40px rgba(0,119,255,0.5);
}

/* Sunset */
body[data-theme="sunset"] .btn.primary{
  background: linear-gradient(145deg, #ff7849, #ffb199);
  color: #fff5ee;
  text-shadow: 0 0 8px #ffb199, 0 0 20px #ff7849;
  box-shadow: 0 0 16px rgba(255,120,73,0.85), 0 0 38px rgba(255,177,153,0.55);
}

/* Neon Night */
body[data-theme="neon-night"] .btn.primary{
  background: linear-gradient(145deg, #ff00ff, #ff66ff);
  color: #fff0ff;
  text-shadow: 0 0 10px #ff66ff, 0 0 22px #ff00ff;
  box-shadow: 0 0 20px rgba(255,0,255,0.9), 0 0 45px rgba(255,102,255,0.6);
}

/* Aurora */
body[data-theme="aurora"] .btn.primary{
  background: linear-gradient(145deg, #00ffc3, #00b3ff);
  color: #eafffb;
  text-shadow: 0 0 10px #00ffc3, 0 0 22px #00b3ff;
  box-shadow: 0 0 18px rgba(0,255,195,0.85), 0 0 42px rgba(0,179,255,0.6);
}

/* Forest */
body[data-theme="forest"] .btn.primary{
  background: linear-gradient(145deg, #3dfc7e, #00c853);
  color: #edfff3;
  text-shadow: 0 0 8px #3dfc7e, 0 0 20px #00c853;
  box-shadow: 0 0 16px rgba(61,252,126,0.85), 0 0 40px rgba(0,200,83,0.55);
}

/* Chroma Glow */
body[data-theme="chroma"] .btn.primary{
  background: linear-gradient(145deg, #7c3aed, #a78bfa);
  color: #f6f1ff;
  text-shadow: 0 0 10px #a78bfa, 0 0 24px #7c3aed;
  box-shadow: 0 0 20px rgba(124,58,237,0.9), 0 0 44px rgba(167,139,250,0.6);
}

/* Light */
body[data-theme="light"] .btn.primary{
  background: linear-gradient(145deg, #0077ff, #66bfff);
  color: #f7fbff;
  text-shadow: 0 0 8px #66bfff, 0 0 20px #0077ff;
  box-shadow: 0 0 16px rgba(0,119,255,0.75), 0 0 40px rgba(102,191,255,0.5);
}
</style>


<!-- injected: v3 limited autoshrink (minScale=0.9, fallback to local scroll) -->
<style id="limited-autoshrink-style">
/* Local scroll fallback container */
.local-hscroll{overflow-x:auto;-webkit-overflow-scrolling:touch;position:relative;width:100%;}
.local-hscroll::-webkit-scrollbar{height:8px}
.local-hscroll > .local-hscroll-inner{display:inline-block;min-width:100%}
/* Media should not exceed container by default */
img,video,canvas,svg,iframe,embed,object{max-width:100%;height:auto}
</style>
<script id="limited-autoshrink-script">
(function(){
  const MIN_SCALE = 0.9; // don't scale smaller than this
  const EXCLUDE = new Set(['PRE','CODE','KBD','SAMP','TEXTAREA']);
  const WRAP_CLASS = 'autoshrink-wrap';
  const TARGET_CLASS = 'autoshrink-target';

  function isExcluded(el){
    if (EXCLUDE.has(el.tagName)) return true;
    if (el.closest('.hscroll,.table-wrap,.local-hscroll')) return true;
    if (el.closest('pre,code,kbd,samp,textarea')) return true;
    return false;
  }

  function ensureShrinkWrap(el){
    if (el.classList.contains(TARGET_CLASS) && el.parentElement?.classList.contains(WRAP_CLASS)) {
      return el.parentElement;
    }
    const wrap = document.createElement('div');
    wrap.className = WRAP_CLASS;
    el.classList.add(TARGET_CLASS);
    el.parentNode.insertBefore(wrap, el);
    wrap.appendChild(el);
    return wrap;
  }

  function makeLocalScroll(el){
    // unwrap if previously shrink-wrapped
    if (el.classList.contains(TARGET_CLASS) && el.parentElement?.classList.contains(WRAP_CLASS)){
      const wrap = el.parentElement;
      wrap.parentNode.insertBefore(el, wrap);
      wrap.remove();
      el.classList.remove(TARGET_CLASS);
      el.style.transform = 'none';
    }
    // already in local-hscroll?
    if (el.parentElement && el.parentElement.classList.contains('local-hscroll')) return;
    const outer = document.createElement('div');
    outer.className = 'local-hscroll';
    const inner = document.createElement('div');
    inner.className = 'local-hscroll-inner';
    el.parentNode.insertBefore(outer, el);
    outer.appendChild(inner);
    inner.appendChild(el);
  }

  function resetScale(el){
    el.style.transform = 'none';
    if (el.parentElement?.classList.contains(WRAP_CLASS)){
      el.parentElement.style.height = '';
    }
  }

  function fitElement(el){
    const vw = document.documentElement.clientWidth;
    resetScale(el);
    const sw = el.scrollWidth;
    if (sw <= vw + 1) return; // fine

    const scale = vw / sw;
    if (scale >= MIN_SCALE) {
      // do controlled shrink
      const wrap = ensureShrinkWrap(el);
      el.style.transform = 'scale(' + scale + ')';
      const rect = el.getBoundingClientRect();
      wrap.style.height = rect.height + 'px';
    } else {
      // below readable threshold -> local horizontal scroll
      makeLocalScroll(el);
    }
  }

  function collectOffenders(){
    const vw = document.documentElement.clientWidth;
    const all = Array.from(document.body.querySelectorAll('*'));
    return all.filter(el=>{
      if (!(el instanceof HTMLElement)) return false;
      if (isExcluded(el)) return false;
      if (el.offsetParent === null) return false;
      if (el.tagName === 'HTML' || el.tagName === 'BODY') return false;
      if (el.clientWidth === 0 && el.clientHeight === 0) return false;
      try { return el.scrollWidth > vw + 1; } catch(e){ return false; }
    });
  }

  function apply(){
    collectOffenders().forEach(fitElement);
  }

  let rafId=null;
  function schedule(){ if(rafId) cancelAnimationFrame(rafId); rafId=requestAnimationFrame(apply); }

  window.addEventListener('load', schedule, {passive:true});
  window.addEventListener('resize', schedule, {passive:true});
  const ro = new ResizeObserver(()=>schedule()); ro.observe(document.documentElement);
  const mo = new MutationObserver(()=>schedule());
  mo.observe(document.body,{subtree:true,childList:true,attributes:true,attributeFilter:['style','class']});
})();
</script>

</body>
</html>
