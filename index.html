<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>아스팔트 레전드 결제 계산기 — 단축키/프리셋</title>
  <meta name="description" content="팩 개수와 추가 금액을 입력하면 (합계)*4 + 1000 공식을 적용해 원(ARS)으로 표시합니다. 키보드 단축키와 프리셋 지원." />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{
      --bg:#0b1020; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --brand:#0ea5e9; --ring:rgba(14,165,233,.35);
      --bgL:#ffffff; --textL:#0f172a; --mutedL:#475569; --cardL:#f8fafc;
      --radius:16px; --shadow:0 12px 30px rgba(2,6,23,.25);
    }
    html{color-scheme:light dark}
    body{margin:0; font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, Arial, sans-serif; background:var(--bg); color:var(--text);}
    @media (prefers-color-scheme: light){ body{background:var(--bgL); color:var(--textL);} }
    .container{max-width:980px; margin:0 auto; padding:24px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0}
    h1{font-size:clamp(22px,4vw,34px); margin:0}
    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid rgba(148,163,184,.18)}
    @media (prefers-color-scheme: light){ .card{background:var(--cardL); border-color:rgba(15,23,42,.08);} }
    .muted{color:var(--muted)}

    /* 표 영역 */
    .table{display:grid; grid-template-columns:140px 1fr 130px; gap:0;}
    .thead,.row{display:contents}
    .th,.td{padding:12px 14px; border-bottom:1px dashed rgba(148,163,184,.25)}
    .th{font-weight:700}
    .controls{display:inline-grid; grid-template-columns:auto 64px auto; gap:8px; align-items:center}
    .btn{padding:8px 10px; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:transparent; color:inherit; cursor:pointer}
    .btn:focus{outline:3px solid var(--ring); outline-offset:2px}
    .num{width:64px; padding:8px 10px; text-align:center; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:transparent; color:inherit}

    /* 옵션/프리셋/합계 */
    .grid{display:grid; gap:14px}
    .panel{display:grid; grid-template-columns:1fr 1fr; gap:14px; padding:14px}
    .field{display:grid; gap:6px}
    .field input{padding:10px 12px; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:transparent; color:inherit}
    .totals{padding:16px}
    .totals .line{display:flex; justify-content:space-between; align-items:center; padding:6px 0; font-variant-numeric:tabular-nums}
    .totals .grand{margin-top:8px; padding-top:10px; border-top:1px solid rgba(148,163,184,.25); font-size:20px; font-weight:800}

    details{padding:14px;}
    details summary{cursor:pointer; list-style:none}
    details summary::-webkit-details-marker{display:none}
    .preset-list{display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:10px; margin-top:10px}
    .preset{padding:10px 12px; border:1px solid rgba(148,163,184,.35); border-radius:12px; cursor:pointer}

    footer{padding:18px 0; color:var(--muted); font-size:14px}
    .kbd{font:600 12px/1.3 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; background:rgba(148,163,184,.18); padding:.35em .55em; border-radius:8px}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>아스팔트 레전드 결제 계산기</h1>
      <div class="muted">공식: <span class="kbd">(29a+70b+142c+284d+714e+1429f + extra) × 4 + 1000 → 원(ARS)</span></div>
    </header>

    <!-- 팩 표 -->
    <section class="card" aria-labelledby="packsTitle">
      <h2 id="packsTitle" class="sr-only">팩 개수 입력</h2>
      <div class="table" id="table">
        <div class="thead">
          <div class="th">팩(ARS)</div>
          <div class="th">개수</div>
          <div class="th" style="text-align:right">소계(ARS)</div>
        </div>
        <!-- 행들이 스크립트로 삽입됨 -->
      </div>
    </section>

    <!-- 사용자 지정 가격 입력 -->
    <section class="card panel" style="margin-top:14px" aria-labelledby="extraTitle">
      <h2 id="extraTitle" class="sr-only">추가 가격</h2>
      <div class="field">
        <label for="extra">사용자 지정 추가 금액 (ARS)</label>
        <input id="extra" class="num" type="number" step="1" min="0" value="0" />
        <div class="muted">빈칸에 아무 숫자 입력 → 합계에 그대로 더해집니다.</div>
      </div>
      <div class="field">
        <label for="note">메모 (선택)</label>
        <input id="note" type="text" placeholder="예: 특정 번들 추가" />
      </div>
    </section>

    <!-- 프리셋/단축키 -->
    <section class="card grid" style="margin-top:14px" aria-labelledby="presetTitle">
      <h2 id="presetTitle" class="sr-only">단축키 및 프리셋</h2>
      <details>
        <summary><strong>단축키</strong> — <span class="muted">1–6: 해당 팩 +1, Shift+1–6: -1 · 0: 전체 초기화 · C: 추가금 입력 포커스 · S: 요약 복사</span></summary>
      </details>
      <details>
        <summary><strong>프리셋 선택</strong> — 자주 쓰는 조합을 한 번에 적용</summary>
        <div class="preset-list" id="presetList"></div>
      </details>
    </section>

    <!-- 합계/결과 -->
    <section class="card totals" style="margin-top:14px" aria-labelledby="sumTitle">
      <h2 id="sumTitle" class="sr-only">합계</h2>
      <div class="line"><span>팩 합계</span><strong id="sumArs">0 ARS</strong></div>
      <div class="line"><span>+ 사용자 지정</span><strong id="extraArs">0 ARS</strong></div>
      <div class="line"><span>= 소계</span><strong id="subtotal">0 ARS</strong></div>
      <div class="grand line"><span>공식 적용: ×4 + 1000</span><strong id="result">0 원(ARS)</strong></div>
    </section>

    <div class="grid" style="grid-template-columns:1fr auto; align-items:center; margin-top:10px">
      <div class="muted">링크에 현재 값이 저장돼요. 공유 시 재현 가능.</div>
      <div style="display:flex; gap:8px">
        <button class="btn" id="resetBtn" title="초기화">초기화</button>
        <button class="btn" id="shareBtn">공유 링크 복사</button>
        <button class="btn" id="copyBtn">요약 복사</button>
      </div>
    </div>

    <footer>
      © <span id="year"></span> · 이 결과는 안내용입니다. 실제 결제 금액과 다를 수 있어요.
    </footer>
  </div>

  <script>
    // ===== 설정 =====
    const PACKS = [29,70,142,284,714,1429];

    // 예시 프리셋 (필요 시 자유롭게 수정 가능)
    const PRESETS = [
      {name:'스타터', qty:[1,0,0,0,0,0]},
      {name:'빠른 300', qty:[1,2,0,0,0,0]},
      {name:'추천 조합 A', qty:[0,1,1,0,0,0]},
      {name:'추천 조합 B', qty:[0,0,0,1,1,0]},
      {name:'하이롤러', qty:[0,0,0,0,0,1]},
    ];

    // 상태
    const state = { qty: Array(PACKS.length).fill(0), extra: 0 };

    // 포맷터
    const fmt = n => new Intl.NumberFormat('ko-KR').format(Math.round(n));

    // DOM 참조
    const table = document.getElementById('table');
    const sumArsEl = document.getElementById('sumArs');
    const extraEl = document.getElementById('extra');
    const extraArsEl = document.getElementById('extraArs');
    const subtotalEl = document.getElementById('subtotal');
    const resultEl = document.getElementById('result');

    // 행 렌더링
    function renderRows(){
      // 헤더 다음으로 행 삽입
      PACKS.forEach((p,i)=>{
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div class="td"><strong>${p} ARS</strong></div>
          <div class="td">
            <div class="controls">
              <button class="btn" data-i="${i}" data-delta="-1" aria-label="${p} ARS 감소">−</button>
              <input class="num" id="n${i}" type="number" step="1" min="0" value="0" aria-label="${p} ARS 개수" />
              <button class="btn" data-i="${i}" data-delta="1" aria-label="${p} ARS 증가">＋</button>
            </div>
          </div>
          <div class="td" style="text-align:right"><span id="s${i}">0</span> ARS</div>`;
        table.appendChild(row);
      });

      // 버튼 +/-
      table.addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-i]');
        if(!btn) return;
        const i = +btn.dataset.i; const d = +btn.dataset.delta;
        state.qty[i] = Math.max(0, (state.qty[i]||0) + d);
        document.getElementById('n'+i).value = state.qty[i];
        update();
      });

      // 직접 입력
      PACKS.forEach((_,i)=>{
        const input = document.getElementById('n'+i);
        input.addEventListener('input', ()=>{
          const v = Math.max(0, +input.value||0);
          state.qty[i] = v; update();
        });
      });
    }

    // 계산
    function calc(){
      const sumArs = state.qty.reduce((acc,q,i)=> acc + q*PACKS[i], 0);
      const subtotal = sumArs + (state.extra||0);
      const resultWon = subtotal * 4 + 1000; // 지정 공식
      return {sumArs, subtotal, resultWon};
    }

    function update(){
      // 소계 표시
      state.qty.forEach((q,i)=>{
        document.getElementById('s'+i).textContent = fmt(q*PACKS[i]);
      });
      const {sumArs, subtotal, resultWon} = calc();
      sumArsEl.textContent = fmt(sumArs) + ' ARS';
      extraArsEl.textContent = fmt(state.extra||0) + ' ARS';
      subtotalEl.textContent = fmt(subtotal) + ' ARS';
      resultEl.textContent = fmt(resultWon) + ' 원(ARS)';

      // 해시 저장
      const params = new URLSearchParams();
      if(state.qty.some(q=>q>0)) params.set('q', state.qty.join(','));
      if(state.extra>0) params.set('x', String(state.extra));
      history.replaceState({}, '', location.pathname + (params.toString()?('#'+params.toString()):''));
    }

    // 프리셋 렌더링
    function renderPresets(){
      const list = document.getElementById('presetList');
      PRESETS.forEach(p=>{
        const b = document.createElement('button');
        b.className = 'preset';
        b.textContent = `${p.name} — [${p.qty.join(', ')}]`;
        b.addEventListener('click', ()=>{
          for(let i=0;i<PACKS.length;i++){
            state.qty[i] = Math.max(0, +p.qty[i]||0);
            document.getElementById('n'+i).value = state.qty[i];
          }
          update();
        });
        list.appendChild(b);
      });
    }

    // 단축키
    function handleHotkeys(e){
      // 1~6: 해당 팩 +1, Shift와 함께면 -1
      if(e.key>='1' && e.key<='6'){
        const idx = +e.key - 1;
        const d = e.shiftKey? -1 : 1;
        state.qty[idx] = Math.max(0, (state.qty[idx]||0) + d);
        document.getElementById('n'+idx).value = state.qty[idx];
        update();
      } else if(e.key==='0'){ // 전체 초기화
        resetAll();
      } else if(e.key.toLowerCase()==='c'){ // 추가금 포커스
        extraEl.focus(); extraEl.select();
      } else if(e.key.toLowerCase()==='s'){ // 요약 복사
        copySummary();
      }
    }

    // 공유 링크
    async function copyShare(){
      const url = location.href;
      try{ await navigator.clipboard.writeText(url); alert('공유 링크를 복사했어요!'); }
      catch{ prompt('이 링크를 복사하세요:', url); }
    }

    // 요약 복사
    function copySummary(){
      const {sumArs, subtotal, resultWon} = calc();
      const lines = [];
      PACKS.forEach((p,i)=>{ if(state.qty[i]>0) lines.push(`${p} ARS × ${state.qty[i]} = ${state.qty[i]*p} ARS`); });
      if(state.extra>0) lines.push(`추가: ${state.extra} ARS`);
      lines.push(`소계: ${Math.round(subtotal)} ARS`);
      lines.push(`공식 적용: (소계×4)+1000 = ${Math.round(resultWon)} 원(ARS)`);
      const text = lines.join('\n');
      navigator.clipboard.writeText(text).then(()=>alert('요약을 복사했어요!')).catch(()=>prompt('복사할 내용을 선택해서 복사하세요:', text));
    }

    // 복원
    function restoreFromHash(){
      if(location.hash.length>1){
        const p = new URLSearchParams(location.hash.slice(1));
        const q = p.get('q'); const x = p.get('x');
        if(q){ const arr = q.split(',').map(v=>Math.max(0,+v||0));
          for(let i=0;i<Math.min(arr.length, PACKS.length); i++){
            state.qty[i]=arr[i]; const el=document.getElementById('n'+i); if(el) el.value=arr[i];
          }
        }
        if(x){ state.extra = Math.max(0, +x||0); extraEl.value = state.extra; }
      }
    }

    function resetAll(){
      state.qty = state.qty.map(()=>0); state.extra = 0; extraEl.value = 0; update();
    }

    // 이벤트 바인딩
    document.getElementById('resetBtn').addEventListener('click', resetAll);
    document.getElementById('shareBtn').addEventListener('click', copyShare);
    document.getElementById('copyBtn').addEventListener('click', copySummary);
    extraEl.addEventListener('input', ()=>{ state.extra = Math.max(0, +extraEl.value||0); update(); });
    window.addEventListener('keydown', handleHotkeys);

    // 초기화
    renderRows();
    renderPresets();
    restoreFromHash();
    update();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>