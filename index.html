<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>아스팔트 레전드 결제 계산기 — 프리셋 셀렉트</title>
  <meta name="description" content="팩 개수와 추가 금액을 입력하면 (합계)*4 + 1000 공식을 적용해 원(ARS)으로 표시합니다. 프리셋 드롭다운 지원." />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{
      --bg:#0b1020; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --brand:#0ea5e9; --ring:rgba(14,165,233,.35);
      --bgL:#ffffff; --textL:#0f172a; --mutedL:#475569; --cardL:#f8fafc;
      --radius:16px; --shadow:0 12px 30px rgba(2,6,23,.25);
      --border:1px solid rgba(148,163,184,.18);
    }
    html{color-scheme:light dark}
    body{margin:0; font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, Arial, sans-serif; background:var(--bg); color:var(--text);}
    @media (prefers-color-scheme: light){ body{background:var(--bgL); color:var(--textL);} }
    .container{max-width:980px; margin:0 auto; padding:24px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0}
    h1{font-size:clamp(22px,4vw,34px); margin:0}
    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); border:var(--border)}
    @media (prefers-color-scheme: light){ .card{background:var(--cardL); border:1px solid rgba(15,23,42,.08);} }
    .muted{color:var(--muted)}

    /* 표 영역 */
    .grid-head, .grid-row{display:grid; grid-template-columns:140px 1fr 130px; align-items:center}
    .grid-head{padding:12px 14px; border-bottom:1px dashed rgba(148,163,184,.25); font-weight:700}
    .grid-row{padding:10px 14px; border-bottom:1px dashed rgba(148,163,184,.18)}
    .grid-row:last-child{border-bottom:none}

    .controls{display:inline-grid; grid-template-columns:auto 72px auto; gap:10px; align-items:center}
    .btn{padding:8px 10px; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:transparent; color:inherit; cursor:pointer}
    .btn:focus{outline:3px solid var(--ring); outline-offset:2px}
    .btn.plus{margin-right:10px} /* + 버튼을 약간 오른쪽으로 */
    .num{width:72px; padding:8px 10px; text-align:center; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:transparent; color:inherit}

    /* 합계 */
    .totals{padding:16px}
    .totals .line{display:flex; justify-content:space-between; align-items:center; padding:6px 0; font-variant-numeric:tabular-nums}
    .totals .grand{margin-top:8px; padding-top:10px; border-top:1px solid rgba(148,163,184,.25); font-size:20px; font-weight:800}

    /* 프리셋 셀렉트 */
    .select{position:relative; display:inline-block}
    .select-toggle{display:flex; align-items:center; justify-content:space-between; gap:6px; padding:8px 10px; min-width:280px; border-radius:12px; border:1px solid rgba(148,163,184,.35); background:transparent; color:inherit; cursor:pointer}
    .select-arrow{font-weight:900; font-size:14px}
    .select-panel{position:absolute; left:0; right:0; top:calc(100% + 8px); z-index:999; display:none; max-height:360px; overflow:auto; border:1px solid rgba(148,163,184,.35); border-radius:12px; background:var(--card); box-shadow:var(--shadow)}
    @media (prefers-color-scheme: light){ .select-panel{background:var(--cardL);} }
    .select.open .select-panel{display:block}
    .option{padding:10px 12px; border-bottom:1px dashed rgba(148,163,184,.12); cursor:pointer; user-select:none}
    .option:last-child{border-bottom:none}
    .option:hover{background:rgba(148,163,184,.15)}

    footer{padding:18px 0; color:var(--muted); font-size:14px}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>아스팔트 레전드 결제 계산기</h1>
      <div class="muted">공식: <strong>(29a+70b+142c+284d+714e+1429f + extra) × 4 + 1000 → 원(ARS)</strong></div>
    </header>

    <!-- 팩 표 -->
    <section class="card" aria-labelledby="packsTitle">
      <h2 id="packsTitle" class="sr-only">팩 개수 입력</h2>
      <div class="grid-head">
        <div>팩(ARS)</div><div>개수</div><div style="text-align:right">소계(ARS)</div>
      </div>
      <div id="rows"></div>
    </section>

    <!-- 사용자 지정 가격 + 프리셋 -->
    <section class="card" style="margin-top:14px" aria-labelledby="extraTitle">
      <h2 id="extraTitle" class="sr-only">추가 가격 / 프리셋</h2>
      <div style="display:flex; gap:12px; align-items:end; padding:14px; flex-wrap:wrap">
        <div>
          <label for="extra">사용자 지정 추가 금액 (ARS)</label><br/>
          <input id="extra" class="num" type="number" step="1" min="0" value="0" />
          <div class="muted" style="margin-top:6px">빈칸에 아무 숫자 입력 → 합계에 그대로 더해집니다.</div>
        </div>
        <div>
          <label class="sr-only" for="presetToggle">프리셋 선택</label><br/>
          <div class="select" id="presetSelect">
            <button id="presetToggle" class="select-toggle" type="button" aria-expanded="false" aria-controls="presetPanel">
              <span id="presetLabel">프리셋 선택</span>
              <span class="select-arrow">V</span>
            </button>
            <div id="presetPanel" class="select-panel" role="listbox" aria-label="프리셋 목록"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- 합계/결과 -->
    <section class="card totals" style="margin-top:14px" aria-labelledby="sumTitle">
      <h2 id="sumTitle" class="sr-only">합계</h2>
      <div class="line"><span>팩 합계</span><strong id="sumArs">0 ARS</strong></div>
      <div class="line"><span>+ 사용자 지정</span><strong id="extraArs">0 ARS</strong></div>
      <div class="line"><span>= 소계</span><strong id="subtotal">0 ARS</strong></div>
      <div class="grand line"><span>공식 적용: ×4 + 1000</span><strong id="result">0 원(ARS)</strong></div>
    </section>

    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px">
      <button class="btn" id="resetBtn" title="초기화">초기화</button>
      <button class="btn" id="shareBtn">공유 링크 복사</button>
      <button class="btn" id="copyBtn">요약 복사</button>
    </div>

    <footer>
      © <span id="year"></span> · 이 결과는 안내용입니다. 실제 결제 금액과 다를 수 있어요.
    </footer>
  </div>

  <script>
    // ===== 설정 =====
    const PACKS = [29,70,142,284,714,1429];

    // 프리셋 목록 (16개) — 표시 텍스트에서 수량 배열은 숨김
    const PRESETS = [
      {name:'Infiniti Project Black S 쇼룸', qty:[1,2,6,0,0,0], hint:'[1,2,6,0,0,0]'},
      {name:'NIO EP9 쇼룸', qty:[5,1,13,8,0,0], hint:'[5,1,13,8,0,0]'},
      {name:'BMW i8 쇼룸', qty:[1,7,6,5,0,0], hint:'[1,7,6,5,0,0]'},
      {name:'Renault Sport R.S.01 쇼룸', qty:[1,1,2,7,0,0], hint:'[1,1,2,7,0,0]'},
      {name:'Lotus Emira 쇼룸', qty:[1,4,7,8,0,0], hint:'[1,4,7,8,0,0]'},
      {name:'Lamborghini Miura', qty:[1,0,2,5,3,0], hint:'[1,0,2,5,3,0]'},
      {name:'Honda Civic Type-R', qty:[1,2,4,7,0,0], hint:'[1,2,4,7,0,0]'},
      {name:'Renault Dezir', qty:[3,8,6,0,0,0], hint:'[3,8,6,0,0,0]'},
      {name:'Renault TreZor', qty:[1,4,7,5,0,0], hint:'[1,4,7,5,0,0]'},
      {name:'Ferrari Monza SP1', qty:[1,3,5,8,0,0], hint:'[1,3,5,8,0,0]'},
      {name:'Volkswagen W12', qty:[1,0,0,5,2,3], hint:'[1,0,0,5,2,3]'},
      {name:'Lamborghini Sian FKP 37', qty:[1,0,0,10,7,11], hint:'[1,0,0,10,7,11]'},
      {name:'Boxwell MK X 500', qty:[1,5,5,6,0,0], hint:'[1,5,5,6,0,0]'},
      {name:'Aston Martin V12 Speedstar', qty:[2,3,6,5,0,0], hint:'[2,3,6,5,0,0]'},
      {name:'Saleen S1', qty:[3,4,6,10,0,0], hint:'[3,4,6,10,0,0]'},
      {name:'Vanda Dendrobium', qty:[7,2,19,13,0,0], hint:'[7,2,19,13,0,0]'},
    ];

    // 상태
    const state = { qty: Array(PACKS.length).fill(0), extra: 0 };

    // 포맷터
    const fmt = n => new Intl.NumberFormat('ko-KR').format(Math.round(n));

    // DOM 참조
    const rows = document.getElementById('rows');
    const sumArsEl = document.getElementById('sumArs');
    const extraEl = document.getElementById('extra');
    const extraArsEl = document.getElementById('extraArs');
    const subtotalEl = document.getElementById('subtotal');
    const resultEl = document.getElementById('result');

    const presetSelect = document.getElementById('presetSelect');
    const presetToggle = document.getElementById('presetToggle');
    const presetPanel = document.getElementById('presetPanel');
    const presetLabel = document.getElementById('presetLabel');

    // 행 렌더링 (핵심 UI)
    function renderRows(){
      PACKS.forEach((p,i)=>{
        const row = document.createElement('div');
        row.className = 'grid-row';
        row.innerHTML = `
          <div><strong>${p} ARS</strong></div>
          <div>
            <div class="controls">
              <button class="btn" data-i="${i}" data-delta="-1" aria-label="${p} ARS 감소">−</button>
              <input class="num" id="n${i}" type="number" step="1" min="0" value="0" aria-label="${p} ARS 개수" />
              <button class="btn plus" data-i="${i}" data-delta="1" aria-label="${p} ARS 증가">＋</button>
            </div>
          </div>
          <div style="text-align:right"><span id="s${i}">0</span> ARS</div>`;
        rows.appendChild(row);
      });

      // 버튼 +/- (이벤트 위임)
      rows.addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-i]');
        if(!btn) return;
        const i = +btn.dataset.i; const d = +btn.dataset.delta;
        state.qty[i] = Math.max(0, (state.qty[i]||0) + d);
        document.getElementById('n'+i).value = state.qty[i];
        update();
      });

      // 직접 입력
      PACKS.forEach((_,i)=>{
        const input = document.getElementById('n'+i);
        input.addEventListener('input', ()=>{
          const v = Math.max(0, +input.value||0);
          state.qty[i] = v; update();
        });
      });
    }

    // 프리셋 셀렉트 렌더링 — 화면에는 이름만
    function renderPresetSelect(){
      presetPanel.innerHTML = '';
      PRESETS.forEach((p,idx)=>{
        const opt = document.createElement('div');
        opt.className = 'option';
        opt.role = 'option';
        opt.dataset.idx = idx;
        opt.textContent = p.name;      // 수량 배열은 표시하지 않음
        opt.title = p.hint;            // 필요하면 마우스오버로만 확인
        opt.addEventListener('click', ()=>{ applyPreset(idx); closePreset(); });
        presetPanel.appendChild(opt);
      });

      // 토글 버튼 동작 (열기/닫기)
      presetToggle.addEventListener('click', ()=>{
        const open = presetSelect.classList.toggle('open');
        presetToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      });

      // 외부 클릭 시 닫기
      window.addEventListener('click', (e)=>{
        if(!presetSelect.contains(e.target)) closePreset();
      });
    }

    function closePreset(){
      presetSelect.classList.remove('open');
      presetToggle.setAttribute('aria-expanded','false');
    }

    function applyPreset(i){
      const arr = PRESETS[i].qty;
      for(let k=0;k<PACKS.length;k++){
        state.qty[k] = Math.max(0, +arr[k]||0);
        const el = document.getElementById('n'+k); if(el) el.value = state.qty[k];
      }
      presetLabel.textContent = PRESETS[i].name;
      update();
    }

    // 계산
    function calc(){
      const sumArs = state.qty.reduce((acc,q,i)=> acc + q*PACKS[i], 0);
      const subtotal = sumArs + (state.extra||0);
      const resultWon = subtotal * 4 + 1000; // 지정 공식
      return {sumArs, subtotal, resultWon};
    }

    function update(){
      state.qty.forEach((q,i)=>{ document.getElementById('s'+i).textContent = fmt(q*PACKS[i]); });
      const {sumArs, subtotal, resultWon} = calc();
      sumArsEl.textContent = fmt(sumArs) + ' ARS';
      extraArsEl.textContent = fmt(state.extra||0) + ' ARS';
      subtotalEl.textContent = fmt(subtotal) + ' ARS';
      resultEl.textContent = fmt(resultWon) + ' 원(ARS)';

      // 해시 저장
      const params = new URLSearchParams();
      if(state.qty.some(q=>q>0)) params.set('q', state.qty.join(','));
      if(state.extra>0) params.set('x', String(state.extra));
      history.replaceState({}, '', location.pathname + (params.toString()?('#'+params.toString()):''));
    }

    // 공유 링크 & 요약 복사 & 초기화
    async function copyShare(){
      const url = location.href;
      try{ await navigator.clipboard.writeText(url); alert('공유 링크를 복사했어요!'); }
      catch{ prompt('이 링크를 복사하세요:', url); }
    }
    function copySummary(){
      const {subtotal, resultWon} = calc();
      const lines = [];
      PACKS.forEach((p,i)=>{ if(state.qty[i]>0) lines.push(`${p} ARS × ${state.qty[i]} = ${state.qty[i]*p} ARS`); });
      if(state.extra>0) lines.push(`추가: ${state.extra} ARS`);
      lines.push(`소계: ${Math.round(subtotal)} ARS`);
      lines.push(`공식 적용: (소계×4)+1000 = ${Math.round(resultWon)} 원(ARS)`);
      const text = lines.join('\n');
      navigator.clipboard.writeText(text).then(()=>alert('요약을 복사했어요!')).catch(()=>prompt('복사할 내용을 선택해서 복사하세요:', text));
    }
    function resetAll(){
      // 상태 초기화
      state.qty = state.qty.map(()=>0); state.extra = 0;
      // 입력값/라벨/패널 시각적으로도 초기화
      PACKS.forEach((_,i)=>{ const el=document.getElementById('n'+i); if(el) el.value=0; });
      extraEl.value = 0; presetLabel.textContent = '프리셋 선택';
      closePreset();
      // URL 해시 제거
      history.replaceState({}, '', location.pathname);
      // 표시 갱신
      update();
    }

    // 복원
    function restoreFromHash(){
      if(location.hash.length>1){
        const p = new URLSearchParams(location.hash.slice(1));
        const q = p.get('q'); const x = p.get('x');
        if(q){ const arr = q.split(',').map(v=>Math.max(0,+v||0));
          for(let i=0;i<Math.min(arr.length, PACKS.length); i++){
            state.qty[i]=arr[i]; const el=document.getElementById('n'+i); if(el) el.value=arr[i];
          }
        }
        if(x){ state.extra = Math.max(0, +x||0); extraEl.value = state.extra; }
      }
    }

    // 이벤트 바인딩
    document.getElementById('resetBtn').addEventListener('click', resetAll);
    document.getElementById('shareBtn').addEventListener('click', copyShare);
    document.getElementById('copyBtn').addEventListener('click', copySummary);
    extraEl.addEventListener('input', ()=>{ state.extra = Math.max(0, +extraEl.value||0); update(); });

    // 초기화
    renderRows();
    renderPresetSelect();
    restoreFromHash();
    update();

    // === 간단 테스트 (콘솔) ===
    (function runTests(){
      try{
        console.assert(['a','b'].join('\n')==='a\nb','join("\\n") 실패');
        console.assert(document.querySelectorAll('input.num').length===6,'팩 입력칸 6개 생성 실패');
        console.assert(document.querySelectorAll('#presetPanel .option').length===16,'프리셋 16개 생성 실패');
        console.log('[OK] 기본 테스트 통과');
      }catch(e){ console.error('[TEST FAIL]', e); }
    })();

    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
